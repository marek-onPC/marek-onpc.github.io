import{s as J,r as K,o as Q,n as B}from"../chunks/scheduler.hyw8iwdn.js";import{S as X,i as Y,e as b,s as A,c as v,a as E,d,f as C,l as i,g as F,h,z as V,q as D,m as H,n as Z,k as N,o as $,t as x,b as ee,r as se,u as te,v as ne,w as oe,p as ae}from"../chunks/index.C4qMneLH.js";import{A as re,a as le,b as ie,s as G,g as ue,r as ce,L as _e}from"../chunks/fetchClient.C-yeIqsN.js";import{g as j}from"../chunks/entry.CnPmlBDo.js";function fe(o){let e;return{c(){e=x("Login")},l(s){e=ee(s,"Login")},m(s,t){F(s,e,t)},i:B,o:B,d(s){s&&d(e)}}}function pe(o){let e,s;return e=new _e({props:{isSmall:!0,isWhite:!0}}),{c(){se(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,a){ne(e,t,a),s=!0},i(t){s||(N(e.$$.fragment,t),s=!0)},o(t){H(e.$$.fragment,t),s=!1},d(t){oe(e,t)}}}function de(o){let e;return{c(){e=b("div"),this.h()},l(s){e=v(s,"DIV",{class:!0}),E(e).forEach(d),this.h()},h(){i(e,"class","login__spacer svelte-1niap0b")},m(s,t){F(s,e,t)},d(s){s&&d(e)}}}function me(o){let e,s='<p class="svelte-1niap0b">Error occurred on login, try again.</p>';return{c(){e=b("div"),e.innerHTML=s,this.h()},l(t){e=v(t,"DIV",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-15erdst"&&(e.innerHTML=s),this.h()},h(){i(e,"class","login__error svelte-1niap0b")},m(t,a){F(t,e,a)},d(t){t&&d(e)}}}function he(o){let e,s,t,a,g,y,p,l,I,L,_,c,f,M,u,k,S;const P=[pe,fe],w=[];function O(n,r){return n[3]?0:1}c=O(o),f=w[c]=P[c](o);function W(n,r){return n[4]?me:de}let U=W(o),m=U(o);return{c(){e=b("div"),s=b("form"),t=b("div"),a=b("input"),y=A(),p=b("div"),l=b("input"),L=A(),_=b("button"),f.c(),M=A(),m.c(),this.h()},l(n){e=v(n,"DIV",{class:!0});var r=E(e);s=v(r,"FORM",{class:!0});var T=E(s);t=v(T,"DIV",{class:!0});var q=E(t);a=v(q,"INPUT",{name:!0,placeholder:!0,class:!0}),q.forEach(d),y=C(T),p=v(T,"DIV",{class:!0});var R=E(p);l=v(R,"INPUT",{name:!0,placeholder:!0,type:!0,class:!0}),R.forEach(d),T.forEach(d),L=C(r),_=v(r,"BUTTON",{class:!0});var z=E(_);f.l(z),z.forEach(d),M=C(r),m.l(r),r.forEach(d),this.h()},h(){i(a,"name","username"),i(a,"placeholder","Username"),i(a,"class","input svelte-1niap0b"),a.disabled=o[3],i(t,"class",g="login__input "+(o[1]?"--focused":"")+" svelte-1niap0b"),i(l,"name","password"),i(l,"placeholder","Password"),i(l,"type","password"),i(l,"class","input svelte-1niap0b"),l.disabled=o[3],i(p,"class",I="login__input "+(o[2]?"--focused":"")+" svelte-1niap0b"),i(s,"class","login__form svelte-1niap0b"),i(_,"class","button login__submit svelte-1niap0b"),_.disabled=o[3],i(e,"class","login svelte-1niap0b")},m(n,r){F(n,e,r),h(e,s),h(s,t),h(t,a),V(a,o[0].username),h(s,y),h(s,p),h(p,l),V(l,o[0].password),h(e,L),h(e,_),w[c].m(_,null),h(e,M),m.m(e,null),u=!0,k||(S=[D(a,"input",o[6]),D(a,"focusin",o[7]),D(a,"focusout",o[8]),D(l,"input",o[9]),D(l,"focusin",o[10]),D(l,"focusout",o[11]),D(_,"click",o[5])],k=!0)},p(n,[r]){(!u||r&8)&&(a.disabled=n[3]),r&1&&a.value!==n[0].username&&V(a,n[0].username),(!u||r&2&&g!==(g="login__input "+(n[1]?"--focused":"")+" svelte-1niap0b"))&&i(t,"class",g),(!u||r&8)&&(l.disabled=n[3]),r&1&&l.value!==n[0].password&&V(l,n[0].password),(!u||r&4&&I!==(I="login__input "+(n[2]?"--focused":"")+" svelte-1niap0b"))&&i(p,"class",I);let T=c;c=O(n),c!==T&&($(),H(w[T],1,1,()=>{w[T]=null}),Z(),f=w[c],f||(f=w[c]=P[c](n),f.c()),N(f,1),f.m(_,null)),(!u||r&8)&&(_.disabled=n[3]),U!==(U=W(n))&&(m.d(1),m=U(n),m&&(m.c(),m.m(e,null)))},i(n){u||(N(f),u=!0)},o(n){H(f),u=!1},d(n){n&&d(e),w[c].d(),m.d(),k=!1,K(S)}}}function be(o,e,s){let t={grant_type:re.PASSWORD,username:"",password:""},a=!1,g=!1,y=!1,p=!1;const l=async()=>{s(3,y=!0),s(4,p=!1);try{const k=(await le("/login",t)).data,S=new Date(Date.now()+k.expires_in*1e3),P={accessToken:k.access_token,tokenType:k.token_type,expiry:S,refreshToken:k.refresh_token};ie(P),G.set(P),setTimeout(()=>{j("/dashboard")},500)}catch{s(3,y=!1),s(4,p=!0)}};Q(()=>{const u=ue();u.accessToken&&u.expiry>new Date?j("/dashboard"):(ce(),G.set({accessToken:"",refreshToken:"",expiry:new Date,tokenType:""}))});function I(){t.username=this.value,s(0,t)}const L=()=>s(1,a=!0),_=()=>s(1,a=!1);function c(){t.password=this.value,s(0,t)}return[t,a,g,y,p,l,I,L,_,c,()=>s(2,g=!0),()=>s(2,g=!1)]}class ye extends X{constructor(e){super(),Y(this,e,be,he,J,{})}}export{ye as component};
