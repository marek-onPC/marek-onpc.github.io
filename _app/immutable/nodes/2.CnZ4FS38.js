import{s as J,c as Q,o as X,a as Y,b as Z,u as ee,g as te,d as se,r as ne,n as x}from"../chunks/scheduler.hyw8iwdn.js";import{S as oe,i as ae,e as N,c as I,a as R,d as g,l as w,g as L,m as k,n as V,k as d,o as q,s as S,f as z,p as F,h as E,q as G,r as B,u as H,v as P,w as U,t as re,b as le}from"../chunks/index.C4qMneLH.js";import{g as M}from"../chunks/entry.cdUFzJKg.js";import{f as ie,r as ce,s as O,L as j,a as ue,A as fe,b as _e}from"../chunks/fetchClient.radSaUxS.js";import{M as pe}from"../chunks/Modal.ClTiq9Fi.js";function me(a){let t,s,e,n,r,m,u,h="All sheets",l,c,b="Logout",T,_,C,v,i=a[0]&&K(a);const D=[ke,he],y=[];function W(o,f){return o[1]?0:1}n=W(a),r=y[n]=D[n](a);const A=a[6].default,p=Z(A,a,a[5],null);return{c(){i&&i.c(),t=S(),s=N("nav"),e=N("button"),r.c(),m=S(),u=N("a"),u.textContent=h,l=S(),c=N("button"),c.textContent=b,T=S(),p&&p.c(),this.h()},l(o){i&&i.l(o),t=z(o),s=I(o,"NAV",{class:!0});var f=R(s);e=I(f,"BUTTON",{class:!0});var $=R(e);r.l($),$.forEach(g),m=z(f),u=I(f,"A",{class:!0,href:!0,"data-svelte-h":!0}),F(u)!=="svelte-1xorwtz"&&(u.textContent=h),l=z(f),c=I(f,"BUTTON",{class:!0,"data-svelte-h":!0}),F(c)!=="svelte-smu2c1"&&(c.textContent=b),f.forEach(g),T=z(o),p&&p.l(o),this.h()},h(){w(e,"class","button navigation__button svelte-1dolggz"),e.disabled=a[1],w(u,"class","button navigation__button svelte-1dolggz"),w(u,"href","/dashboard"),w(c,"class","button navigation__button svelte-1dolggz"),w(s,"class","navigation svelte-1dolggz")},m(o,f){i&&i.m(o,f),L(o,t,f),L(o,s,f),E(s,e),y[n].m(e,null),E(s,m),E(s,u),E(s,l),E(s,c),L(o,T,f),p&&p.m(o,f),_=!0,C||(v=[G(e,"click",a[3]),G(c,"click",a[4])],C=!0)},p(o,f){o[0]?i?(i.p(o,f),f&1&&d(i,1)):(i=K(o),i.c(),d(i,1),i.m(t.parentNode,t)):i&&(q(),k(i,1,1,()=>{i=null}),V());let $=n;n=W(o),n!==$&&(q(),k(y[$],1,1,()=>{y[$]=null}),V(),r=y[n],r||(r=y[n]=D[n](o),r.c()),d(r,1),r.m(e,null)),(!_||f&2)&&(e.disabled=o[1]),p&&p.p&&(!_||f&32)&&ee(p,A,o,o[5],_?se(A,o[5],f,null):te(o[5]),null)},i(o){_||(d(i),d(r),d(p,o),_=!0)},o(o){k(i),k(r),k(p,o),_=!1},d(o){o&&(g(t),g(s),g(T)),i&&i.d(o),y[n].d(),p&&p.d(o),C=!1,ne(v)}}}function de(a){let t,s;return t=new j({}),{c(){B(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,n){P(t,e,n),s=!0},p:x,i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){k(t.$$.fragment,e),s=!1},d(e){U(t,e)}}}function K(a){let t,s;return t=new pe({props:{isOpened:a[0],text:"Token expired, reauthenticating",hasLoader:!0}}),{c(){B(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,n){P(t,e,n),s=!0},p(e,n){const r={};n&1&&(r.isOpened=e[0]),t.$set(r)},i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){k(t.$$.fragment,e),s=!1},d(e){U(t,e)}}}function he(a){let t;return{c(){t=re("Create new")},l(s){t=le(s,"Create new")},m(s,e){L(s,t,e)},i:x,o:x,d(s){s&&g(t)}}}function ke(a){let t,s;return t=new j({props:{isSmall:!0,isWhite:!0}}),{c(){B(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,n){P(t,e,n),s=!0},i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){k(t.$$.fragment,e),s=!1},d(e){U(t,e)}}}function be(a){let t,s,e,n,r;const m=[de,me],u=[];function h(l,c){return c&4&&(s=null),s==null&&(s=!l[2].accessToken||l[2].expiry<new Date),s?0:1}return e=h(a,-1),n=u[e]=m[e](a),{c(){t=N("div"),n.c(),this.h()},l(l){t=I(l,"DIV",{class:!0});var c=R(t);n.l(c),c.forEach(g),this.h()},h(){w(t,"class","dashboard svelte-1dolggz")},m(l,c){L(l,t,c),u[e].m(t,null),r=!0},p(l,[c]){let b=e;e=h(l,c),e===b?u[e].p(l,c):(q(),k(u[b],1,1,()=>{u[b]=null}),V(),n=u[e],n?n.p(l,c):(n=u[e]=m[e](l),n.c()),d(n,1),n.m(t,null))},i(l){r||(d(n),r=!0)},o(l){k(n),r=!1},d(l){l&&g(t),u[e].d()}}}function ge(a,t,s){let e;Q(a,O,_=>s(2,e=_));let{$$slots:n={},$$scope:r}=t,m=!1,u=!1,h=!1,l;const c=async()=>{try{s(1,m=!0),u=!1;const _=await ie("/cheat_sheets",e.accessToken,{title:"New cheat sheet",is_published:!1});M(`/dashboard/cs-edit/${_.id}`)}catch{s(1,m=!1),u=!0}s(1,m=!1)},b=async()=>{const _=e.refreshToken;try{const v=(await ue("/login",{grant_type:fe.REFRESH_TOKEN,refresh_token:_})).data,i=new Date(Date.now()+v.expires_in*1e3),D={accessToken:v.access_token,tokenType:v.token_type,expiry:i,refreshToken:v.refresh_token};_e(D),O.set(D),s(0,h=!1)}catch{T()}},T=()=>{ce(),O.set({accessToken:"",refreshToken:"",expiry:new Date,tokenType:""}),M("/login")};return X(()=>{if(!e.accessToken||e.expiry<new Date){M("/login");return}l=setInterval(()=>{e.expiry<new Date&&s(0,h=!0)},1e4)}),Y(()=>clearInterval(l)),a.$$set=_=>{"$$scope"in _&&s(5,r=_.$$scope)},a.$$.update=()=>{a.$$.dirty&1&&h&&setTimeout(()=>{b()},1500)},[h,m,e,c,T,r,n]}class Ce extends oe{constructor(t){super(),ae(this,t,ge,be,J,{})}}export{Ce as component};
